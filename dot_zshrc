eval "$(starship init zsh)"

# general
export EDITOR=nvim
export LANG=C
autoload -Uz colors
colors
bindkey -e

# direnv
eval "$(direnv hook zsh)"

# pyenv
export PYENV_ROOT="$HOME/.pyenv"
export PATH="$PYENV_ROOT/bin:$PATH"

pyenv() {
    unfunction "$0"
    source <(pyenv init -)
    source <(pyenv virtualenv-init -)
    $0 "$@"
}
# eval "$(pyenv init -)"
# eval "$(pyenv virtualenv-init -)"

# rbenv
export PATH="$HOME/.rbenv/shims:$PATH"
rbenv() {
    unfunction "$0"
    source <(rbenv init -)
    $0 "$@"
}

# nodenv
eval "$(nodenv init -)"

# Java
export PATH="/opt/homebrew/opt/openjdk@11/bin:$PATH"
export CPPFLAGS="-I/opt/homebrew/opt/openjdk@11/include"

# PHP
export PATH="/opt/homebrew/opt/php@8.0/bin:$PATH"
export PATH="/opt/homebrew/opt/php@8.0/sbin:$PATH"

# nvm
export NVM_DIR="$HOME/.nvm"
  [ -s "/opt/homebrew/opt/nvm/nvm.sh" ] && \. "/opt/homebrew/opt/nvm/nvm.sh"  # This loads nvm
  [ -s "/opt/homebrew/opt/nvm/etc/bash_completion.d/nvm" ] && \. "/opt/homebrew/opt/nvm/etc/bash_completion.d/nvm"  # This loads nvm bash_completion

# options
setopt print_eight_bit
setopt no_beep
setopt nolistbeep

# history
setopt auto_pushd
setopt share_history
setopt hist_ignore_dups
setopt hist_ignore_space
setopt hist_reduce_blanks
setopt pushd_ignore_dups
setopt hist_ignore_all_dups
HISTSIZE=100000
SAVEHIST=100000

# aliases
alias vi="nvim -u NONE"
alias vim="nvim"
alias view="nvim -R"
alias ls="exa --sort=ext" 
alias tree="exa -T"

alias zshconf="chezmoi edit ~/.zshrc"
alias nvimconf="chezmoi edit ~/.config/nvim/init.lua"
alias tmuxconf="chezmoi edit ~/.tmux.conf"
alias alacrittyconf="chezmoi edit ~/.config/alacritty/alacritty.yml"
alias starshipconf="chezmoi edit ~/.config/starship.toml"

# fish-like behavior
source `brew --prefix`/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
if type brew &>/dev/null; then
    FPATH=$(brew --prefix)/share/zsh-completions:$FPATH
    autoload -Uz compinit
    compinit
fi

# zoxide
eval "$(zoxide init zsh)"

# zsh-autosuggestions
source `brew --prefix`/share/zsh-autosuggestions/zsh-autosuggestions.zsh

# config of fzf
[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh
export FZF_DEFAULT_COMMAND='rg --files --hidden --follow --glob "!**/.git/*"'
export FZF_DEFAULT_OPTS="
    --height 40% --reverse --border=sharp --margin=0,1
    --prompt='> ' --color=dark
"

# for finding files in current directories
export FZF_CTRL_T_COMMAND='rg --files --hidden --follow --glob "!**/.git/*"'
export FZF_CTRL_T_OPTS="
    --preview 'bat  --color=always --style=header,grid {}'
    --preview-window=right:60%
"

# ghq + fzf
function _ghq_fzf() {
  local src=$(ghq list | fzf --preview "ls -laTp $(ghq root)/{} | tail -n+4 | awk '{print \$9\"/\"\$6\"/\"\$7 \" \" \$10}'")
  if [ -n "$src" ]; then
    BUFFER="cd $(ghq root)/$src"
    zle accept-line
  fi
  zle -R -c
}
zle -N _ghq_fzf
bindkey '^g' _ghq_fzf


# jupyter
function jupyter-local() {
    jupyter notebook --notebook-dir=. --ip='*' --no-browser --allow-root --NotebookApp.token='' --NotebookApp.password=''
}

# starship
PYENV_VIRTUALENV_DISABLE_PROMPT=1
